import{r as m,m as U,h as V,j as i,B as q,n as B,V as F}from"./three-DoDmUXEH.js";import{G as J}from"./ground-geiEh1YG.js";import{d as L,u as X,C as Y}from"./index-DTAMNN3q.js";import{e as O,c as S,l as _}from"./easing-B4OZWJ3c.js";const H=({scalarTracker:c,nBoxes:e=5,gridSize:p=10,cellSize:o=.25})=>{const u=p,M=p,C=m.useMemo(()=>new L(.65,150,2*250),[250]),r=m.useRef(null),f=m.useMemo(()=>new U,[]),D=X(),R=Y.getPalette(D).buildLut(),s=m.useMemo(()=>Array.from({length:e},a=>{const n=Math.floor(u*Math.random()),l=Math.floor(M*Math.random());return{fromRow:n,fromCol:l,toRow:n,toCol:l}}),[e,u,M]);return m.useEffect(()=>{if(r.current){for(let a=0;a<e;a++)r.current.setColorAt(a,R.getColor(a/(e-1)));r.current.instanceColor.needsUpdate=!0}},[R,e]),V(()=>{if(!r.current)return;if(C.step((c==null?void 0:c.get())??0)){const[x,w]=Math.random()>.5?[!0,!1]:[!1,!0];for(let t=0;t<e;t++)s[t].fromRow=s[t].toRow,s[t].fromCol=s[t].toCol,x&&(s[t].toRow+=Math.random()>.5?1:-1),w&&(s[t].toCol+=Math.random()>.5?1:-1)}const a=O(S(C.timeSinceLastEventMs/250)),n=_(Math.PI/4,3*Math.PI/4,a),l=-.5*o*Math.cos(n)/Math.sqrt(2),b=.5*o*Math.sin(n)/Math.sqrt(2);let g,j,P,I,v,h,d;for(const[x,{fromRow:w,fromCol:t,toRow:y,toCol:A}]of s.entries()){h=y-w,d=A-t;const E=w+h*(l+.5),G=t+d*(l+.5);h!==0&&f.makeRotationY((n-Math.PI/4)*h),d!==0&&f.makeRotationX(-(n-Math.PI/4)*d),g=E/(u-1),j=G/(M-1),P=u*o*(g-.5),I=M*o*(j-.5),v=b-o/4,f.setPosition(P,I,v),r.current.setMatrixAt(x,f)}r.current.instanceMatrix.needsUpdate=!0}),i.jsxs("instancedMesh",{ref:r,castShadow:!0,receiveShadow:!0,args:[new q,new B,e],children:[i.jsx("boxGeometry",{attach:"geometry",args:[o,o,o,1]}),i.jsx("meshBasicMaterial",{attach:"material",color:"white",toneMapped:!1})]})},$=({scalarTracker:c})=>i.jsxs(i.Fragment,{children:[i.jsx(H,{scalarTracker:c??{get:()=>Math.sin(.0025*Date.now())+1,set:()=>{}},nBoxes:200,gridSize:100,cellSize:1}),i.jsx(J,{position:new F(0,0,-1/2)})]});export{$ as default};
