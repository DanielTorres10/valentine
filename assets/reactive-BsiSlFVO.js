import{r,ac as O,j as e,ad as v,h as E,m as b,V as x,Q as D,ae as L,B as N,af as F}from"./three-CTWSiUJi.js";import{u as j,C,b as G}from"./index-C4rnqq9n.js";import{e as V,E as Q}from"./easing-B4OZWJ3c.js";const U="/r3f-audio-visualizer/assets/horse-DMamucGr.png",B=a=>{const m=r.useRef(null),{nodes:i,animations:d}=O(U),p=j(),t=C.getPalette(p).buildLut(),o=r.useMemo(()=>e.jsx("meshStandardMaterial",{color:t.getColor(.5),flatShading:!0}),[t]),{actions:n}=v(d,m);return r.useEffect(()=>{n?.horse_A_?.play()}),E(({clock:h})=>{const l=h.getElapsedTime(),f=(Math.sin(.5*l)+1)/2;n?.horse_A_?.setEffectiveTimeScale(f)}),e.jsx("group",{ref:m,scale:[.025,.025,.025],rotation:[Math.PI/2,Math.PI,0],dispose:null,children:e.jsxs("group",{name:"AuxScene",children:[e.jsx("pointLight",{position:[10,100,200],intensity:100}),e.jsx("mesh",{name:"mesh_0",castShadow:!0,receiveShadow:!0,geometry:i.mesh_0.geometry,morphTargetDictionary:i.mesh_0.morphTargetDictionary,morphTargetInfluences:i.mesh_0.morphTargetInfluences,children:o})]})})},H=[[-1,1],[-.75,-.1],[-.6,0],[0,0],[.6,0],[.75,-.1],[1,1]],W=({nStones:a=30,stoneWidth:m=5,stoneHeight:i=.1,stoneLength:d=1,coordinateMapper:p})=>{const t=r.useRef(null),[o,n,h,l]=r.useMemo(()=>[new b,new x,new D,new x],[]),M=r.useMemo(()=>new L(H.map(c=>new x(0,c[0],c[1]).multiplyScalar(10)),!1,"catmullrom",.1),[]),f=j(),w=C.getPalette(f).buildLut();return r.useEffect(()=>{if(t.current){for(let s=0;s<a;s++)t.current.setColorAt(s,w.getColor(s/(a-1)));t.current.instanceColor.needsUpdate=!0}},[t,w,a]),E(({clock:s})=>{if(!t.current)return;const c=s.getElapsedTime(),S=.025,A=.5,T=S*(c-Math.cos(A*c)/A)%1,_=1-V(T,Q.LINEAR);for(let u=0;u<a;u++){const g=(_+u/a)%1,I=1-2*Math.abs(g-.5),P=Math.abs(g-.5),y=.5+p.map(G.CARTESIAN_1D,P,c)/2,R=I*(1+y);t.current.getMatrixAt(u,o),o.decompose(n,h,l),M.getPointAt(g,n),l.set(R,1,1),o.compose(n,h,l),t.current.setMatrixAt(u,o)}t.current.instanceMatrix.needsUpdate=!0}),e.jsx(e.Fragment,{children:e.jsxs("instancedMesh",{ref:t,castShadow:!0,receiveShadow:!0,count:a,args:[new N,new F,a],children:[e.jsx("boxGeometry",{attach:"geometry",args:[m,d,i,1,1,1]}),e.jsx("meshStandardMaterial",{attach:"material",color:"white",toneMapped:!1})]})})},J=({...a})=>e.jsxs(e.Fragment,{children:[e.jsx(W,{...a}),e.jsx(B,{...a})]});export{J as default};
